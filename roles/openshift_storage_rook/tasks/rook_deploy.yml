---
- import_tasks: mktemp.yml

- assert:
    that: "rook_ceph_nodes | count >= 3"
    msg: There must be at least three rook ceph nodes specified

- name: Copy Rook Ceph Operator template
  copy:
    src: "rook-ceph-operator-template.yml"
    dest: "{{ mktemp.stdout }}/rook-ceph-operator-template.yml"

- import_tasks: label_nodes.yml

- name: Create Rook Ceph template
  oc_obj:
    namespace: "{{ rook_ceph_system_namespace }}"
    kind: template
    name: "rook-ceph"
    state: present
    files:
    - "{{ mktemp.stdout }}/rook-ceph-operator-template.yml"

- name: Generate cluster file
  template:
    src: "rook-ceph-cluster.yml.j2"
    dest: "{{ mktemp.stdout }}/rook-ceph-cluster.yml"

- name: Create Rook Ceph Cluster
  oc_obj:
    state: present
    kind: namespace
    name: "{{ rook_ceph_namespace }}"
    files:
    - "{{ mktemp.stdout }}/rook-ceph-cluster.yml"
